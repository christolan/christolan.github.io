---
title: TCP 握手与挥手详解
date: "2024-03-07T08:45:00+00:00"
published: true
feature: ""
tags: 计算机网络
permalink: /tcp-handshake-and-handshake/
---

在计算机网络中，TCP（传输控制协议）连接的建立和断开分别需要三次握手和四次挥手。下面我们详细说明这两个过程。

## 三次握手

三次握手用于建立 TCP 连接，必须由客户端发起：

- 客户端 -> 服务器：发送一个带 SYN 标志的数据包（SYN=1, seq=c）。
- 服务器 -> 客户端：响应一个带 SYN 和 ACK 标志的数据包（SYN=1, ACK=1, seq=s, ack=c+1）。
- 客户端 -> 服务器：发送一个带 ACK 标志的数据包（ACK=1, seq=c+1, ack=s+1）。

通过三次握手，客户端和服务器确认了彼此的存在并同步了初始序列号。

### 为什么不是两次或四次握手？

- 两次握手：可能导致“已失效连接”问题，即延迟的数据包可能在连接结束后再次被接收，造成资源浪费。
- 四次握手：增加了不必要的开销，并不能显著提高可靠性。

## 四次挥手

四次挥手用于断开 TCP 连接，可以由客户端或服务器发起：

- A -> B：发送一个带 FIN 标志的数据包（FIN=1）。
- B -> A：响应一个带 ACK 标志的数据包（ACK=1）。
- B -> A：发送一个带 FIN 标志的数据包（FIN=1）。
- A -> B：响应一个带 ACK 标志的数据包（ACK=1）。

通过四次挥手，确保双方都完成了数据传输并确认了连接的断开。

### 为什么需要四次挥手？

断开连接时，需要确保一方数据传输完成后，另一方才能发起结束请求，因此需要四次消息交换来保证所有数据都已传输完毕。
